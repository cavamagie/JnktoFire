import groovy.json.JsonOutput
pipeline {
    agent any
    stages {
        stage('Vars') {
          steps {
            script {

              def dockerImage = 'cavamagie/ansibledockerjnk:latest'
              def podName = "my-pod"
              def poddo = "poddo"
              writeFile file: 'params.json', text: JsonOutput.toJson(params)
              
              writeYaml file: 'params.yaml', data: poddo
              echo sh(returnStdout: true, script: 'env')

            }
          }
        }
        stage('Build') {
            agent {
                docker {
                    image 'cavamagie/ansibledockerjnk:latest'
                    // Run the container on the node specified at the
                    // top-level of the Pipeline, in the same workspace,
                    // rather than on a new node entirely:
                    args "-u root:root"
                    reuseNode true
                }
                }
   
            steps {
                sh 'pwd'
                sh "ls"
                shell "whoami"



                sh "ansible-playbook Playbook.yaml -vvvvvvvvvvvv -i inventory.pippo --extra_vars '@params.json' "
            }

                }
            }
        }


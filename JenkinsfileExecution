import groovy.json.JsonOutput
pipeline {
    agent any
    stages {
        stage('Vars') {
          steps {
            script {

              def dockerImage = 'alpine/ansible'
              def podName = "my-pod"
              def poddo = "poddo"
              writeFile file: 'params.json', text: JsonOutput.toJson(params)
              
              writeYaml file: 'params.yaml', data: poddo
              echo sh(returnStdout: true, script: 'env')

            }
          }
        }
        stage('Build') {
            agent {
                docker {
                    image 'ansible/centos7-ansible'
                    // Run the container on the node specified at the
                    // top-level of the Pipeline, in the same workspace,
                    // rather than on a new node entirely:
                    reuseNode false
                }
                }
   
            steps {
                sh 'pwd'
                sh "ls"
                sh "whoami"
                sh "mkdir -p /.ansible/tmp"
                sh "chmod -R 777 /.ansible/tmp"
                sh "sudo ansible-playbook playbook.yaml -vvvvvvvvvvvv -i inventory.pippo "
            }

                }
            }
        }


import groovy.json.JsonOutput
pipeline {
    agent any
    stages {
        stage('Vars') {
          steps {
             cleanWs()
            script {
              writeFile file: 'params.json', text: JsonOutput.toJson(params)
              echo sh(returnStdout: true, script: 'env')

            }
          }
        }
       stage('CheckVars') {
            agent {
                docker {
                    image params.Images
                    args "-u root:root"
                    reuseNode true
                }
                }
   
            steps {
                sh 'pwd'             
                sh "ls -latr"       
                sh "ansible-playbook Playbook.yaml -v -e \"@params.json\""
            }

                }
        stage('Clone') {
            agent {
                docker {
                    image params.Images
                    args "-u root:root"
                    reuseNode true
                }
                }
   
            steps {
                sh 'pwd'
                sh " git clone https://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@github.ibm.com/Luigi-Molinaro/fyre-automation.git /tmp/fyre"                
                sh "ls /tmp"       
            }

                }        
       stage('Run') {
            agent {
                docker {
                    image params.Images
                    args "-u root:root"
                    reuseNode true
                }
                }
   
            steps {
                sh 'pwd'             
                sh "ls /tmp"       
                sh "ansible-playbook /tmp/fyre/fyre-automation/fyre-automation.yaml -v -e \"@params.json\""
            }

                }
            
        stage('clean') {
            agent {
                docker {
                    image params.Images
                    args "-u root:root"
                    reuseNode true
                }
                }
   
            steps {
                sh 'pwd'

                sh " rm -rf /tmp/fyre"                

            }

                }
            }
        }
